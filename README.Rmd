---
output: github_document
editor_options: 
  chunk_output_type: console
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# hrqolr <img src="man/figures/hrqolr.png" align="right" width="120" />

<!-- badges: start -->
[![R-CMD-check](https://github.com/epiben/hrqolr/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/epiben/hrqolr/actions/workflows/R-CMD-check.yaml)
<!-- [![codecov](https://codecov.io/gh/INCEPTdk/adaptr/branch/main/graph/badge.svg)](https://app.codecov.io/gh/INCEPTdk/adaptr/)
![total downloads from RStudio mirror](https://cranlogs.r-pkg.org/badges/grand-total/hrqolr) -->
<!-- badges: end -->

Package for simulating two-arm randomised clinical trials with temporal trajectories of
health-related quality of life (HRQoL) as the outcome and quantifies effect sizes as single-sampled
HRQoL values at end of follow-up and as the area under the trajectories. 

Developed as part of the INCEPT (Intensive Care Platform Trial) project (<https://incept.dk/>),
which is primarily supported by a grant from Sygeforsikringen "danmark"
(<https://www.sygeforsikring.dk/>).

## Resources

* [Website](https://inceptdk.github.io/hrqolr/index.html) - stand-alone website with full
package documentation
* [Health-related quality of life trajectories in critical illness: protocol for a Monte Carlo simulation study](https://doi.org/10.1111/aas.14324) -
article in Acta Anaesthesiologica Scandinavica outlining the first scientific study to use `hrqolr`

## Installation

`hrqolr` isn't on CRAN yet but can be installed from GitHub if you have the `remotes` package installed:

```{r eval = FALSE}
# install.packages("remotes") 
remotes::install_github("INCEPTdk/hrqolr")
```

You can also install the **development version** from directly from GitHub. Doing this
requires the *remotes*-package installed. The development version may contain
additional features not yet available in the stable CRAN version, but may be unstable or lack documentation.

```{r eval = FALSE}
remotes::install_github("INCEPTdk/hrqolr@dev")
```

## Example
First, load the package:
```{r}
library(hrqolr)
```

--then, we activate the cache. This is optional but highly recommended.

```{r eval=FALSE}
cache_hrqolr()
```

`hrqolr` was built to simulate many scenarios, but here we define a single scenario and use `do.call` to give the list elements as named arguments to the function:

```{r}
scenario <- list(
	n_trials = 100L,
	n_patients_per_arm = 100L,
	sampling_frequency = 14L,
	n_patients_ground_truth = 1000L,
	n_example_trajectories_per_arm = 100L,
	
	arms = c("A", "B"),
	index_hrqol = c(A = 0.0, B = 0.0),
	first_hrqol = c(A = 0.1, B = 0.1),
	final_hrqol = c(A = 0.8, B = 0.7),
	acceleration_hrqol = c(A = 0.1, B = 0.0),
	
	mortality = c(A = 0.4, B = 0.4),
	mortality_dampening = c(A = 0.0, B = 0.0),
	mortality_trajectory_shape = c(A = "exp_decay", B = "exp_decay"),
	prop_mortality_benefitters = c(A = 0.0, B = 0.0),
	n_digits = 3
)

example_trajs <- do.call(sample_example_trajectories, scenario)
example_trajs
```

### Visualise trajectories
```{r}
plot(example_trajs)
```

You might also want to break apart the trajectories in the arms. Hiding the legend, then, makes sense as the facet strips will already provide the same information. Here, we also set the arm-level trajectory in black to set it apart from the individual patient trajectories:

```{r}
library(ggplot2) 

plot(example_trajs, arm_aes = list(colour = "black")) +
	facet_wrap(~ arm) +
	theme(legend.position = "none")
```

Of course, we might also be interested in summarising the trajectories. Here, for example, with inter-quartile ranges. Note that the ribbons become a bit wonky at end of follow-up because there are increasingly few observations, and some of them may be low because, e.g., *mortality benefitters* are still alive.

```{r}
plot(example_trajs, "summarise", ribbon_percentiles = c(0.25, 0.75))
```

The same scenario specification can, then, be used to simulate a desired number of trials:
```{r}
sims <- do.call(simulate_trials, scenario)
sims
```

## Issues and enhancements

We use the [GitHub issue tracker](https://github.com/epiben/hrqolr/issues) for
all bug/issue reports and proposals for enhancements. 

## Contributing

We welcome contributions directly to the code to improve performance as well
as new functionality. For the latter, please first explain and motivate it in an
[issue](https://github.com/epiben/hrqolr/issues).

Changes to the code base should follow these steps:

- [Fork](https://docs.github.com/en/get-started/quickstart/fork-a-repo) the repository
- [Make a branch](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-and-deleting-branches-within-your-repository) with an appropriate name in your fork
- Implement changes in your fork, make sure it passes R CMD check (with neither
errors, warnings, nor notes) and add a bullet at the top of NEWS.md with a short
description of the change, your GitHub handle and the id of the pull request
implementing the change (check the `NEWS.md` file to see the formatting)
- Create a [pull request](https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/creating-a-pull-request-from-a-fork) into the `dev` branch
of `adaptr`

## Citation

If using `hrqolr`, please consider citing it:

```{r}
citation(package = "hrqolr")
```
